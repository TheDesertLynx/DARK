<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <script src="https://unpkg.com/dash@latest/dist/dash.min.js"></script> <!-- Dash SDK -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- For Markdown rendering if used -->
    <style>
        body {
            font-family: Arial, sans-serif;
            background: black; /* Black background */
            color: white; /* White text */
            text-align: center; /* Centered content */
            margin: 0;
            padding: 20px;
        }
        img {
            width: 400px; /* Twice as big (assuming original was 200px) */
            display: block;
            margin: 0 auto; /* Centered image */
        }
        .portrait { flex-direction: column; }
        .landscape { flex-direction: row; }
        /* Add more layout classes as needed */
    </style>
</head>
<body id="body">
    <h1 id="title">Loading...</h1>
    <img id="image" alt="Image" src="">
    <p id="text">Loading...</p>
    <div id="formattedContent"></div>
    <div id="additionalText"></div>
    <div id="htmlContent"></div> <!-- Optional for backup rendering -->

    <script>
        function loadContent() {
            if (typeof Dash === 'undefined') {
                console.error('Dash SDK failed to load. Check network or extensions.');
                document.body.innerHTML = '<p>Error: Could not load Dash SDK. Try disabling browser extensions or checking your connection.</p>';
                return;
            }

            const client = new Dash.Client({
                network: 'testnet',
                apps: {
                    myContract: {
                        contractId: 'XJMWN5fHC8p2BjHbWJvyBegj575DNhQTGSghpN2ToFk', // Your new contract ID
                    },
                },
            });

            const query = {
                where: [['$id', '==', 'Dj68wM7QRA4vvCZXaXqmkH7Kmfmvy76esg2pNBtuGtuP']], // Your document ID
            };

            client.platform.documents.get('myContract.page', query)
                .then(documents => {
                    if (documents.length > 0) {
                        const doc = documents[0].toJSON();
                        
                        // Metadata handling
                        const meta = doc.metadata || {};
                        document.getElementById('title').innerText = meta.title || 'DARK Project';
                        document.title = meta.title || 'DARK Project'; // Browser title
                        
                        // Apply layout/orientation from metadata
                        const layout = meta.layout || 'portrait';
                        document.body.classList.add(layout);

                        // Image
                        document.getElementById('image').src = doc.image || '';

                        // Text (with potential Markdown/HTML parsing)
                        document.getElementById('text').innerHTML = marked.parse(doc.text || 'No text available');

                        // Formatted Content
                        document.getElementById('formattedContent').innerHTML = marked.parse(doc.formattedContent || '');

                        // Additional Text
                        document.getElementById('additionalText').innerHTML = marked.parse(doc.additionalText || '');

                        // HTML Content (backup - optional rendering)
                        // document.getElementById('htmlContent').innerHTML = doc.htmlContent || '';
                    } else {
                        document.body.innerHTML = '<p>No content found.</p>';
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    document.body.innerHTML = '<p>Error loading content: ' + error.message + '</p>';
                });
        }

        window.addEventListener('load', loadContent);
    </script>
</body>
</html>
